---
// Canvas component - Main drawing area
---

<div class="canvas-container">
  <!-- Canvas Controls -->
  <div class="canvas-controls glass-panel">
    <div class="control-group">
      <span class="control-label">Width:</span>
      <select class="control-select" id="paper-width">
        <option value="384" selected>384px (Thermal)</option>
        <option value="576">576px (Wide)</option>
      </select>
    </div>

    <div class="control-group">
      <span class="control-label">Zoom:</span>
      <span class="control-value" id="zoom-level">100%</span>
    </div>

    <button class="control-btn" id="fit-canvas" title="Fit to Screen">
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
        ></path>
      </svg>
    </button>
  </div>

  <!-- Canvas Workspace -->
  <div class="canvas-workspace" id="canvas-workspace">
    <div class="canvas-grid" id="canvas-grid"></div>
    <canvas id="main-canvas" width="384" height="800" class="main-canvas"
    ></canvas>

    <!-- Canvas Overlay Info -->
    <div class="canvas-info">
      <span class="info-badge">384px × Variable</span>
      <span class="info-badge">1-bit B&W</span>
      <span class="info-badge">Thermal MXW01</span>
    </div>
  </div>
</div>

<script>
  // Canvas initialization and interaction
  const canvas = document.getElementById("main-canvas") as HTMLCanvasElement;
  const ctx = canvas.getContext("2d");
  const workspace = document.getElementById("canvas-workspace");
  const zoomLevelEl = document.getElementById("zoom-level");
  const fitCanvasBtn = document.getElementById("fit-canvas");

  let zoom = 1;
  let panX = 0;
  let panY = 0;
  let isPanning = false;
  let lastX = 0;
  let lastY = 0;

  if (ctx) {
    // Initialize canvas with thermal paper appearance
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Add some placeholder content
    ctx.fillStyle = "#000000";
    ctx.font = "bold 24px Inter";
    ctx.textAlign = "center";
    ctx.fillText("⚡ THERMAL", canvas.width / 2, canvas.height / 2 - 40);
    ctx.fillText("PRINT STUDIO", canvas.width / 2, canvas.height / 2 - 10);

    ctx.font = "12px Inter";
    ctx.fillText(
      "384px × Variable Height",
      canvas.width / 2,
      canvas.height / 2 + 30
    );
    ctx.fillText("1-bit Monochrome", canvas.width / 2, canvas.height / 2 + 50);
    ctx.fillText(
      "Click tools to start",
      canvas.width / 2,
      canvas.height / 2 + 80
    );

    // Draw border to show print area
    ctx.strokeStyle = "#cccccc";
    ctx.lineWidth = 1;
    ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
  }

  // Pan functionality
  workspace?.addEventListener("mousedown", (e: MouseEvent) => {
    if (e.button === 1 || (e.button === 0 && e.shiftKey)) {
      isPanning = true;
      lastX = e.clientX;
      lastY = e.clientY;
      workspace.style.cursor = "grabbing";
      e.preventDefault();
    }
  });

  workspace?.addEventListener("mousemove", (e: MouseEvent) => {
    if (isPanning) {
      const deltaX = e.clientX - lastX;
      const deltaY = e.clientY - lastY;
      panX += deltaX;
      panY += deltaY;
      lastX = e.clientX;
      lastY = e.clientY;
      updateCanvasTransform();
    }
  });

  workspace?.addEventListener("mouseup", () => {
    isPanning = false;
    workspace.style.cursor = "default";
  });

  // Zoom functionality
  workspace?.addEventListener("wheel", (e: WheelEvent) => {
    e.preventDefault();
    const delta = e.deltaY > 0 ? 0.9 : 1.1;
    zoom *= delta;
    zoom = Math.max(0.1, Math.min(5, zoom)); // Limit zoom range
    updateCanvasTransform();
    if (zoomLevelEl) {
      zoomLevelEl.textContent = `${Math.round(zoom * 100)}%`;
    }
  });

  // Fit to screen
  fitCanvasBtn?.addEventListener("click", () => {
    if (workspace) {
      const rect = workspace.getBoundingClientRect();
      const scaleX = rect.width / canvas.width;
      const scaleY = rect.height / canvas.height;
      zoom = Math.min(scaleX, scaleY) * 0.9;
      panX = 0;
      panY = 0;
      updateCanvasTransform();
      if (zoomLevelEl) {
        zoomLevelEl.textContent = `${Math.round(zoom * 100)}%`;
      }
    }
  });

  function updateCanvasTransform() {
    if (canvas) {
      canvas.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
    }
  }

  // Initialize canvas position
  updateCanvasTransform();
</script>

<style>
  .canvas-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
  }

  .canvas-controls {
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 10;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 0.5rem 1rem;
    animation: slideIn 0.5s ease-out;
  }

  .control-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .control-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    font-weight: 600;
  }

  .control-value {
    font-size: 0.75rem;
    color: var(--color-text-primary);
    font-weight: 600;
    min-width: 45px;
  }

  .control-select {
    background: var(--color-bg-tertiary);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all var(--transition-normal);
  }

  .control-select:hover,
  .control-select:focus {
    border-color: var(--color-purple-primary);
    outline: none;
  }

  .control-btn {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-normal);
  }

  .control-btn:hover {
    border-color: var(--color-purple-primary);
    color: var(--color-purple-primary);
  }

  .canvas-workspace {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
    cursor: default;
  }

  .canvas-grid {
    position: absolute;
    inset: 0;
    background-image: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 19px,
        var(--color-border) 19px,
        var(--color-border) 20px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 19px,
        var(--color-border) 19px,
        var(--color-border) 20px
      );
    opacity: 0.3;
    pointer-events: none;
  }

  .main-canvas {
    background: white;
    box-shadow:
      0 20px 60px rgba(0, 0, 0, 0.8),
      0 0 0 1px var(--color-border);
    border-radius: var(--radius-sm);
    transition: transform var(--transition-normal);
    cursor: crosshair;
  }

  .canvas-info {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
  }

  .info-badge {
    background: var(--color-bg-tertiary);
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border);
    padding: 0.25rem 0.75rem;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
  }
</style>
